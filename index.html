<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>SYA</title>

<link rel="manifest" href="manifest.json"/>
<meta id="themeColor" name="theme-color" content="#ffa0e5"/>
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500&family=Cormorant+Garamond:wght@400;500&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@300" rel="stylesheet"/>

<style>
:root{--primary:#ffa0e5;--text:#ffffff;}
*{margin:0;padding:0;box-sizing:border-box;-webkit-user-select:none;user-select:none;}
html,body{
  /* Usamos 100dvh para evitar espacios en la parte inferior al cerrar el teclado */
  height:100dvh;
  width:100%;
  overflow:hidden;
  background:#f5f5f7;
  font-family:'Cormorant Garamond',serif;
  color:var(--text);
  overscroll-behavior:none;touch-action:none;
  transition:background .5s ease;
}

/* Bloqueo */
#lockScreen{position:absolute;inset:0;z-index:999;display:flex;flex-direction:column;justify-content:center;align-items:center;background:#000;transition:opacity .6s}
#lockScreen.fade-out{opacity:0;}
.material-symbols-outlined.heart{font-size:3.2rem;margin-bottom:.6rem;opacity:0;color:#fff;animation:fadeZoom .8s forwards,heartbeat 1.8s infinite}
@keyframes fadeZoom{to{opacity:1;transform:scale(1)}}
@keyframes heartbeat{0%,100%{transform:scale(1)}50%{transform:scale(1.12)}}
#lockScreen h2{font-family:'Dancing Script',cursive;font-size:2.2rem;opacity:0;animation:fadeZoom .8s forwards}
#lockScreen input,#lockScreen button{border:none;outline:none;font-size:1rem;}
#lockScreen input{margin-top:.5rem;padding:.45rem .7rem;border-radius:6px;text-align:center}
#lockScreen button{margin-top:.6rem;padding:.4rem .9rem;background:var(--primary);color:#fff;border-radius:6px;cursor:pointer}
#error{margin-top:.4rem;color:#ff8585;display:none}

/* Slides */
#slider{position:absolute;inset:0;height:100dvh;width:100%;display:none;}
#slider.show{display:block;animation:appear .7s ease;}
@keyframes appear{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
.slide{position:absolute;inset:0;opacity:0;transform:scale(1.04);transition:.8s}
.slide.active{opacity:1;transform:scale(1);z-index:1}

.overlay{position:absolute;inset:0;display:flex;flex-direction:column;justify-content:flex-end;align-items:center;background:linear-gradient(rgba(0,0,0,0),rgba(0,0,0,.35));backdrop-filter:blur(14px);padding-bottom:3rem;text-align:center;animation:fadeUp .7s both}
@keyframes fadeUp{from{opacity:0;transform:translateY(25px);}to{opacity:1;transform:translateY(0);}}
.polaroid{max-width:80%;border:12px solid #fff;border-bottom-width:22px;box-shadow:0 6px 14px rgba(0,0,0,.55);margin:0 auto 1rem;pointer-events:none}
h3{font-family:'Dancing Script',cursive;font-size:2rem;margin-bottom:.4rem}
.date{opacity:.8;margin-bottom:.7rem}

/* Barra Top Fixed */
.topBar{position:fixed;top:0;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.25);padding:.45rem .8rem;border-radius:12px;z-index:50;display:flex;align-items:center;gap:.45rem}
#searchBtn{cursor:pointer;}#searchBtn:active{transform:scale(.9)}
#searchInput{background:rgba(255,255,255,.25);border:none;border-radius:6px;color:#fff;font-size:1rem;width:60px;padding:.2rem .4rem;outline:none;display:none;opacity:0;transform:translateX(-10px);transition:.25s}
#searchInput.visible{display:block;opacity:1;transform:translateX(0)}

/* Badge + animación */
.badge{background:var(--primary);padding:.15rem .6rem;border-radius:12px;font-size:.75rem;display:none;z-index:60}
.badge.show{display:inline-block;animation:badgePop .4s;}
@keyframes badgePop{from{opacity:0;transform:scale(.2)}to{opacity:1;transform:scale(1)}}
@keyframes badgeShake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}50%{transform:translateX(5px)}75%{transform:translateX(-5px)}}

/* zonas / flechas */
.edge{position:absolute;top:0;height:100%;width:50%;z-index:10}
#leftEdge{left:0;} #rightEdge{right:0;}
.nav-btn{position:absolute;top:50%;transform:translateY(-50%);font-family:'Material Symbols Outlined';font-size:3rem;color:#fff;opacity:.15;pointer-events:none}
#leftArrow{left:1rem;} #rightArrow{right:1rem;}
</style>
</head>

<body oncontextmenu="return false;">
<div id="lockScreen">
  <span class="material-symbols-outlined heart">diagnosis</span>
  <h2>Álbum de SYA 💜</h2>
  <input id="pwInput" type="password" placeholder="Contraseña">
  <button onclick="checkPw()">Entrar</button>
  <div id="error">Contraseña incorrecta</div>
</div>

<div id="slider">
  <div class="slide" data-title="Momento 1" data-desc="Descripción" data-date="2025-08-12"></div>
  <div class="slide" data-title="Momento 2" data-desc="Descripción" data-date="2025-08-13"></div>
  <div class="slide" data-title="Momento 3" data-desc="Descripción" data-date="2025-08-14"></div>
  <div class="slide" data-title="Momento 4" data-desc="Descripción" data-date="2025-08-15"></div>
  <div class="slide" data-title="Momento 5" data-desc="Descripción" data-date="2025-08-16"></div>
  <div class="slide" data-title="Momento 6" data-desc="Descripción" data-date="2025-08-17"></div>
</div>

<div class="topBar">
  <span id="searchBtn" class="material-symbols-outlined">search</span>
  <input id="searchInput" type="number" inputmode="numeric" min="1">
  <span id="counter"></span>
  <span id="newBadge" class="badge">Nueva</span>
</div>

<div id="leftEdge"  class="edge"></div>
<div id="rightEdge" class="edge"></div>
<div id="leftArrow" class="nav-btn">chevron_left</div>
<div id="rightArrow" class="nav-btn">chevron_right</div>

<script>
let lockEnabled=false;

/* Mostrar badge y hacer shake 1 vez */
function showBadge(){
  const badge=document.getElementById('newBadge');
  badge.classList.add('show');

  // Ocultar al tocar
  window.addEventListener('click',function rm(){
    badge.style.display='none';
    localStorage.setItem('slidesSeen',slides.length.toString());
    window.removeEventListener('click',rm);
  });

  // Shake (una sola vez) después de 3s
  setTimeout(()=>{
    if(getComputedStyle(badge).display!=='none'){
      badge.style.animation="badgeShake .5s";
      setTimeout(()=>{badge.style.animation="";},500);
    }
  },3000);
}

function checkPw(){
  const encoded="U1lBMjUxOQ==";
  if(document.getElementById('pwInput').value===atob(encoded)){
    const lock=document.getElementById('lockScreen');
    lock.querySelector('.heart').style.animation="none";
    lock.querySelector('.heart').style.opacity="0";
    lock.querySelector('h2').style.transition="opacity .6s, transform .6s";
    lock.querySelector('h2').style.opacity="0";
    lock.querySelector('h2').style.transform="scale(.95)";
    setTimeout(()=>{
      lock.classList.add('fade-out');
      setTimeout(()=>{
        lock.style.display='none';
        document.getElementById('slider').classList.add('show');
        lockEnabled=true;

        // Badge logic
        const seen=parseInt(localStorage.getItem('slidesSeen')||'0');
        if(slides.length>seen){showBadge();}
      },300);
    },150);
  } else {
    document.getElementById('error').style.display='block';
  }
}
document.getElementById('pwInput').addEventListener('keydown',e=>{if(e.key==="Enter")checkPw();});

/* Slides  */
const slides=document.querySelectorAll('.slide'),counter=document.getElementById('counter'),searchBtn=document.getElementById('searchBtn'),searchIn=document.getElementById('searchInput'),months=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"];

const bgColors=[];let hue=Math.floor(Math.random()*360),step=360/slides.length;
for(let i=0;i<slides.length;i++){bgColors.push(`hsl(${hue},65%,86%)`);hue=(hue+step)%360;}
document.documentElement.style.background=bgColors[0];
themeColor.setAttribute('content',bgColors[0]);
lockScreen.style.background=bgColors[0];

slides.forEach((s,i)=>{
  s.style.backgroundColor=bgColors[i];
  const img=new Image();
  img.src=`momentos/foto${i+1}.jpg`;img.onerror=()=>img.src='momentos/foto0.jpg';
  img.className='polaroid';
  img.style.transform=`rotate(${(Math.random()*6-3)}deg)`;
  const d=new Date(s.dataset.date);
  const ov=document.createElement('div');
  ov.className='overlay';
  ov.appendChild(img);
  ov.innerHTML+=`<h3>${s.dataset.title}</h3><div class="date">${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear()}</div><p>${s.dataset.desc}</p>`;
  s.appendChild(ov);
});

let current=0;
slides[current].classList.add('active');
counter.textContent=`1 / ${slides.length}`;

/* Change slide */
function changeSlide(d){
  if(!lockEnabled) return;
  slides[current].classList.remove('active');
  current=(current+d+slides.length)%slides.length;
  slides[current].classList.add('active');
  document.documentElement.style.background=bgColors[current];
  themeColor.setAttribute('content',bgColors[current]);
  counter.textContent=(current+1)+' / '+slides.length;
}
leftEdge.onclick=()=>{changeSlide(-1);}
rightEdge.onclick=()=>{changeSlide(1);}
let sx=0;
window.addEventListener('touchstart',e=>{sx=e.touches[0].clientX});
window.addEventListener('touchend',e=>{
  if(!lockEnabled) return;
  const ex=e.changedTouches[0].clientX;
  if(sx-ex>50)changeSlide(1);
  if(ex-sx>50)changeSlide(-1);
});

/* Buscador */
searchBtn.onclick=e=>{
  if(!lockEnabled) return;
  e.stopPropagation();
  searchIn.style.display='block';
  requestAnimationFrame(()=>searchIn.classList.add('visible'));
  searchIn.focus();
};
searchIn.onchange=()=>{
  const n=parseInt(searchIn.value);
  if(n>=1 && n<=slides.length)changeSlide((n-1)-current);
  searchIn.classList.remove('visible');
  setTimeout(()=>{searchIn.style.display='none';searchIn.value='';},200);
};
window.addEventListener('click',e=>{
  if(e.target!==searchBtn && e.target!==searchIn && searchIn.style.display==='block'){
    searchIn.classList.remove('visible');
    setTimeout(()=>{searchIn.style.display='none';searchIn.value='';},200);
  }
});

if('serviceWorker' in navigator)navigator.serviceWorker.register('service-worker.js');
</script>
</body>
</html>